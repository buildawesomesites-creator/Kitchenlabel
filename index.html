<!DOCTYPE html>
<html lang="vi" translate="no">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<meta name="google" content="notranslate">
<title>Kitchenlabel</title>
<meta name="theme-color" content="#ffffff">

<style>
  html,body{
    margin:0;padding:0;
    width:80mm;
    height:100%;
    font-family:"Helvetica Neue","Noto Sans","Roboto",Arial,sans-serif;
    background:#fff;color:#000;font-size:12px;
    overflow-x:hidden;
  }
  body{display:flex;flex-direction:column;justify-content:flex-start;min-height:100%;}
  .content{flex:1;padding:5px;}
  .copies{font-size:10px;margin-bottom:2px;text-align:left;}
  .center{text-align:center;}
  .title{font-weight:600;font-size:14px;margin:2px 0 4px 0;}
  .info{margin:0 0 6px 0;font-size:11px;}
  .info em{color:#444;font-style:normal;display:block;margin-top:4px;}
  hr{border:none;border-top:1px solid #000;margin:4px 0;}
  table{width:100%;border-collapse:collapse;}
  td{padding:2px 0;vertical-align:top;font-size:12px;}
  .code{font-size:10px;color:#666;}
  .qty-input{width:30px;font-size:11px;border:1px solid #ccc;border-radius:3px;text-align:right;margin-left:4px;}
  .no-print{margin-top:6px;text-align:center;}
  button{font-size:12px;padding:4px 6px;margin:2px;border:1px solid #aaa;background:#f5f5f5;border-radius:3px;}
  .small-btn{font-size:10px;padding:1px 4px;}
  input[type="text"]{font-size:12px;padding:4px;width:80%;border:1px solid #ccc;border-radius:4px;}
  #installAppBtn{display:none;background:#ff7a00;color:#fff;border:none;border-radius:4px;padding:6px 10px;margin-top:5px;}
  @media print{.no-print{display:none!important;} body{margin:0;padding:0;width:80mm;}}
</style>
</head>
<body>
<div class="content">
  <div class="copies">Copies 1</div>
  <div class="center title">CH·∫æ BI·∫æN</div>

  <p class="info">
    <strong>B√†n:</strong> B√ÄN 3<br>
    <strong>Ph·ª•c v·ª•:</strong> Qu·ª≥nh Anh
    <em id="datetime"></em>
  </p>

  <hr>

  <table>
    <thead>
      <tr style="font-weight:600;">
        <td>M√≥n</td>
        <td style="text-align:right; width:18mm;">ƒêVT</td>
        <td style="text-align:right; width:12mm;">SL</td>
        <td></td>
      </tr>
    </thead>
    <tbody id="productList"></tbody>
  </table>

  <hr>

  <div class="no-print">
    <input type="text" id="searchProduct" placeholder="Search product..." list="productListData">
    <datalist id="productListData"></datalist><br>
    <button onclick="addSelectedProduct()">Add</button>
    <button onclick="clearProducts()">Clear All</button>
    <button onclick="printReceipt()">Print</button>
    <button onclick="downloadReceipt()">Download</button>
    <br>
    <!-- ‚úÖ Install button (now visible when allowed) -->
    <button id="installAppBtn">üì≤ C√†i ƒë·∫∑t ·ª©ng d·ª•ng</button>
  </div>
</div>

<script>
// ‚úÖ Basic PWA manifest (injected dynamically)
const manifest = {
  name: "Kitchenlabel",
  short_name: "Kitchenlabel",
  start_url: "./index.html",
  scope: "./",
  display: "standalone",
  orientation: "portrait",
  background_color: "#ffffff",
  theme_color: "#ffffff",
  icons: [
    { src: "icon-192.png", sizes: "192x192", type: "image/png" },
    { src: "icon-512.png", sizes: "512x512", type: "image/png" }
  ]
};
const blob = new Blob([JSON.stringify(manifest)], {type:'application/json'});
const link = document.createElement('link');
link.rel = 'manifest';
link.href = URL.createObjectURL(blob);
document.head.appendChild(link);

// ‚úÖ Handle install prompt
let deferredPrompt;
const installBtn = document.getElementById('installAppBtn');

window.addEventListener('beforeinstallprompt', (e) => {
  e.preventDefault();
  deferredPrompt = e;
  installBtn.style.display = 'inline-block';
  console.log('‚úÖ beforeinstallprompt triggered');
});

installBtn.addEventListener('click', async () => {
  if (!deferredPrompt) return;
  deferredPrompt.prompt();
  const choice = await deferredPrompt.userChoice;
  console.log('User choice:', choice.outcome);
  deferredPrompt = null;
  installBtn.style.display = 'none';
});

// ‚úÖ Register Service Worker correctly for GitHub Pages
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('./service-worker.js')
    .then(() => console.log('‚úÖ Service Worker registered'))
    .catch(err => console.error('‚ùå SW registration failed:', err));
}
</script>

<!-- Include jsPDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</body>
</html>
